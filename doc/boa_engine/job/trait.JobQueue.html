<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A queue of `ECMAscript` Jobs."><title>JobQueue in boa_engine::job - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-9bb858ba049f1f21.css" id="mainThemeStyle"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="boa_engine" data-themes="" data-resource-suffix="" data-rustdoc-version="1.72.0 (5680fa18f 2023-08-23)" data-channel="1.72.0" data-search-js="search-f6292fe389d70017.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-0f8c037637f9eb3e.css" data-theme-dark-css="dark-1097f8e92a01e3cf.css" data-theme-ayu-css="ayu-614652228113ac93.css" ><script src="../../static.files/storage-59fd9b8ccb335783.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-0795b7d26be81095.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../static.files/light-0f8c037637f9eb3e.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../static.files/dark-1097f8e92a01e3cf.css"><link rel="stylesheet" href="../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="icon" href="https://raw.githubusercontent.com/boa-dev/boa/main/assets/logo.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../boa_engine/index.html"><img src="https://raw.githubusercontent.com/boa-dev/boa/main/assets/logo.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../boa_engine/index.html"><img src="https://raw.githubusercontent.com/boa-dev/boa/main/assets/logo.svg" alt="logo"></a><h2 class="location"><a href="#">JobQueue</a></h2><div class="sidebar-elems"><section><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.enqueue_future_job">enqueue_future_job</a></li><li><a href="#tymethod.enqueue_promise_job">enqueue_promise_job</a></li><li><a href="#tymethod.run_jobs">run_jobs</a></li></ul><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.run_jobs_async">run_jobs_async</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In boa_engine::job</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="../index.html">boa_engine</a>::<wbr><a href="index.html">job</a>::<wbr><a class="trait" href="#">JobQueue</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../src/boa_engine/job.rs.html#186-244">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub trait JobQueue {
    // Required methods
    fn <a href="#tymethod.enqueue_promise_job" class="fn">enqueue_promise_job</a>(&amp;self, job: <a class="struct" href="struct.NativeJob.html" title="struct boa_engine::job::NativeJob">NativeJob</a>, context: &amp;mut <a class="struct" href="../struct.Context.html" title="struct boa_engine::Context">Context</a>&lt;'_&gt;);
<span class="item-spacer"></span>    fn <a href="#tymethod.run_jobs" class="fn">run_jobs</a>(&amp;self, context: &amp;mut <a class="struct" href="../struct.Context.html" title="struct boa_engine::Context">Context</a>&lt;'_&gt;);
<span class="item-spacer"></span>    fn <a href="#tymethod.enqueue_future_job" class="fn">enqueue_future_job</a>(&amp;self, future: <a class="type" href="type.FutureJob.html" title="type boa_engine::job::FutureJob">FutureJob</a>, context: &amp;mut <a class="struct" href="../struct.Context.html" title="struct boa_engine::Context">Context</a>&lt;'_&gt;);

    // Provided method
    fn <a href="#method.run_jobs_async" class="fn">run_jobs_async</a>&lt;'a, 'ctx, 'host, 'fut&gt;(
        &amp;'a self,
        context: &amp;'ctx mut <a class="struct" href="../struct.Context.html" title="struct boa_engine::Context">Context</a>&lt;'host&gt;
    ) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.72.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.72.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.72.0/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="primitive" href="https://doc.rust-lang.org/1.72.0/std/primitive.unit.html">()</a>&gt; + 'fut&gt;&gt;
       <span class="where">where 'a: 'fut,
             'ctx: 'fut,
             'host: 'fut</span> { ... }
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A queue of <code>ECMAscript</code> <a href="https://tc39.es/ecma262/#sec-jobs">Jobs</a>.</p>
<p>This is the main API that allows creating custom event loops with custom job queues.</p>
</div></details><h2 id="required-methods" class="small-section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.enqueue_promise_job" class="method"><a class="srclink rightside" href="../../src/boa_engine/job.rs.html#208">source</a><h4 class="code-header">fn <a href="#tymethod.enqueue_promise_job" class="fn">enqueue_promise_job</a>(&amp;self, job: <a class="struct" href="struct.NativeJob.html" title="struct boa_engine::job::NativeJob">NativeJob</a>, context: &amp;mut <a class="struct" href="../struct.Context.html" title="struct boa_engine::Context">Context</a>&lt;'_&gt;)</h4></section></summary><div class="docblock"><p><a href="https://tc39.es/ecma262/#sec-hostenqueuepromisejob"><code>HostEnqueuePromiseJob ( job, realm )</code></a>.</p>
<p>Enqueues a <a href="struct.NativeJob.html" title="struct boa_engine::job::NativeJob"><code>NativeJob</code></a> on the job queue.</p>
<h5 id="requirements"><a href="#requirements">Requirements</a></h5>
<p>Per the <a href="https://tc39.es/ecma262/#sec-hostenqueuepromisejob">spec</a>:</p>
<blockquote>
<p>An implementation of <code>HostEnqueuePromiseJob</code> must conform to the requirements in <a href="https://tc39.es/ecma262/#sec-jobs">9.5</a> as well as the
following:</p>
<ul>
<li>If <code>realm</code> is not null, each time <code>job</code> is invoked the implementation must perform implementation-defined steps
such that execution is prepared to evaluate ECMAScript code at the time of job’s invocation.</li>
<li>Let <code>scriptOrModule</code> be <code>GetActiveScriptOrModule()</code> at the time <code>HostEnqueuePromiseJob</code> is invoked. If realm
is not null, each time job is invoked the implementation must perform implementation-defined steps such that
<code>scriptOrModule</code> is the active script or module at the time of job’s invocation.</li>
<li>Jobs must run in the same order as the <code>HostEnqueuePromiseJob</code> invocations that scheduled them.</li>
</ul>
</blockquote>
<p>Of all the requirements, Boa guarantees the first two by its internal implementation of <code>NativeJob</code>, meaning
the implementer must only guarantee that jobs are run in the same order as they’re enqueued.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.run_jobs" class="method"><a class="srclink rightside" href="../../src/boa_engine/job.rs.html#215">source</a><h4 class="code-header">fn <a href="#tymethod.run_jobs" class="fn">run_jobs</a>(&amp;self, context: &amp;mut <a class="struct" href="../struct.Context.html" title="struct boa_engine::Context">Context</a>&lt;'_&gt;)</h4></section></summary><div class="docblock"><p>Runs all jobs in the queue.</p>
<p>Running a job could enqueue more jobs in the queue. The implementor of the trait
determines if the method should loop until there are no more queued jobs or if
it should only run one iteration of the queue.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.enqueue_future_job" class="method"><a class="srclink rightside" href="../../src/boa_engine/job.rs.html#223">source</a><h4 class="code-header">fn <a href="#tymethod.enqueue_future_job" class="fn">enqueue_future_job</a>(&amp;self, future: <a class="type" href="type.FutureJob.html" title="type boa_engine::job::FutureJob">FutureJob</a>, context: &amp;mut <a class="struct" href="../struct.Context.html" title="struct boa_engine::Context">Context</a>&lt;'_&gt;)</h4></section></summary><div class="docblock"><p>Enqueues a new <a href="https://doc.rust-lang.org/1.72.0/core/future/future/trait.Future.html" title="trait core::future::future::Future"><code>Future</code></a> job on the job queue.</p>
<p>On completion, <code>future</code> returns a new <a href="struct.NativeJob.html" title="struct boa_engine::job::NativeJob"><code>NativeJob</code></a> that needs to be enqueued into the
job queue to update the state of the inner <code>Promise</code>, which is what ECMAScript sees. Failing
to do this will leave the inner <code>Promise</code> in the <code>pending</code> state, which won’t call any <code>then</code>
or <code>catch</code> handlers, even if <code>future</code> was already completed.</p>
</div></details></div><h2 id="provided-methods" class="small-section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.run_jobs_async" class="method"><a class="srclink rightside" href="../../src/boa_engine/job.rs.html#233-243">source</a><h4 class="code-header">fn <a href="#method.run_jobs_async" class="fn">run_jobs_async</a>&lt;'a, 'ctx, 'host, 'fut&gt;(
    &amp;'a self,
    context: &amp;'ctx mut <a class="struct" href="../struct.Context.html" title="struct boa_engine::Context">Context</a>&lt;'host&gt;
) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.72.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.72.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.72.0/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="primitive" href="https://doc.rust-lang.org/1.72.0/std/primitive.unit.html">()</a>&gt; + 'fut&gt;&gt;<span class="where fmt-newline">where
    'a: 'fut,
    'ctx: 'fut,
    'host: 'fut,</span></h4></section></summary><div class="docblock"><p>Asynchronously runs all jobs in the queue.</p>
<p>Running a job could enqueue more jobs in the queue. The implementor of the trait
determines if the method should loop until there are no more queued jobs or if
it should only run one iteration of the queue.</p>
<p>By default forwards to <a href="trait.JobQueue.html#tymethod.run_jobs" title="method boa_engine::job::JobQueue::run_jobs"><code>JobQueue::run_jobs</code></a>. Implementors using async should override this
with a proper algorithm to run jobs asynchronously.</p>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"><section id="impl-JobQueue-for-IdleJobQueue" class="impl"><a class="srclink rightside" href="../../src/boa_engine/job.rs.html#262-268">source</a><a href="#impl-JobQueue-for-IdleJobQueue" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.JobQueue.html" title="trait boa_engine::job::JobQueue">JobQueue</a> for <a class="struct" href="struct.IdleJobQueue.html" title="struct boa_engine::job::IdleJobQueue">IdleJobQueue</a></h3></section><section id="impl-JobQueue-for-SimpleJobQueue" class="impl"><a class="srclink rightside" href="../../src/boa_engine/job.rs.html#293-315">source</a><a href="#impl-JobQueue-for-SimpleJobQueue" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.JobQueue.html" title="trait boa_engine::job::JobQueue">JobQueue</a> for <a class="struct" href="struct.SimpleJobQueue.html" title="struct boa_engine::job::SimpleJobQueue">SimpleJobQueue</a></h3></section></div><script src="../../implementors/boa_engine/job/trait.JobQueue.js" async></script></section></div></main></body></html>