name: Build Artifacts

on:
  pull_request:
    branches:
      - main

jobs: 
  build_cli_tape:
    name: Generate boa_cli GIF
    runs-on: ubuntu-latest
    timeout-minutes: 60
    steps:
      - uses: actions/checkout@v4
      - uses: dtolnay/rust-toolchain@stable
      - run: cargo install --path ./cli
      # Below is from vhs-actions examples
      # https://github.com/charmbracelet/vhs-action/blob/main/examples/auto-commit.yml
      - uses: charmbracelet/vhs-action@v1
        with:
          version: v0.7.1
          path: './.github/tapes/ci_cli_intro.tape'
      - uses: mfinelli/setup-imagemagick@v5
        with:
          cache: true
      - run: magick compare -verbose ./tmp/boa_cli.gif ./cli/assets/boa_cli.gif
      # Clean up tmp directory created by ci_cli_intro.tape
      - run: rm -rf ./tmp
